<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>
    if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone) {
      document.querySelector('meta[name="viewport"]').setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
    }
  </script>
  <title>å¿«é©é£Ÿå ‚ | Smart Restaurant</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ff8533">
  <link rel="icon" href="icon.png" type="image/png">
  <link rel="apple-touch-icon" href="icon.png">
  <meta property="og:title" content="å¿«é©é£Ÿå ‚ | Smart Restaurant">
  <meta property="og:description" content="å­¦é£Ÿã®æ··é›‘çŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç¢ºèªï¼ç©ºã„ã¦ã„ã‚‹æ™‚é–“ã‚’ç‹™ã£ã¦è¡Œã“ã†ã€‚">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://traffic-restaurant.web.app/">
  <meta property="og:image" content="https://traffic-restaurant.web.app/icon.png">
  <meta name="twitter:card" content="summary">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>
  <style>
    :root {
      --primary: #ff8533;
      --primary-dark: #e67326;
      --bg: #F9F7F2;
      --surface: #FFFFFF;
      --surface-sub: #F0EBE5;
      --surface-alpha: rgba(255, 255, 255, 0.85);
      --text: #2c2420;
      --text-sub: #6d5e56;
      --border: #e6e0d8;
      --accent-free: #388E3C;
      --accent-busy: #D32F2F;
      --card-shadow: 0 4px 20px rgba(62, 39, 35, 0.08);
      --sidebar-shadow: 4px 0 24px rgba(62, 39, 35, 0.15);
    }
    body.dark-mode {
      --primary: #ffa366;
      --primary-dark: #ff8533;
      --bg: #1c1917;
      --surface: #2d2622;
      --surface-sub: #3d3632;
      --surface-alpha: rgba(45, 38, 34, 0.85);
      --text: #f5f0e6;
      --text-sub: #b0a69e;
      --border: #4d4540;
      --accent-free: #81c784;
      --accent-busy: #e57373;
      --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.6);
      --sidebar-shadow: 4px 0 24px rgba(0, 0, 0, 0.5);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Inter', 'Noto Sans JP', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      -webkit-tap-highlight-color: transparent;
      padding-bottom: 40px;
      overscroll-behavior: none;
      transition: background-color 0.3s, color 0.3s;
    }
    canvas { touch-action: pan-y; }
    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
      position: relative;
      height: 60px;
    }
    .menu-toggle-btn {
      background: none;
      border: none;
      color: var(--text);
      cursor: pointer;
      padding: 8px;
      margin-right: 8px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
      z-index: 10;
    }
    .menu-toggle-btn:active { background: var(--surface-sub); }
    .menu-toggle-btn .material-icons-round { font-size: 28px; }
    .brand {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      white-space: nowrap;
      z-index: 5;
    }
    .brand-icon { font-size: 2rem; color: var(--primary); }
    .brand-text { display: flex; flex-direction: column; line-height: 1.1; }
    .brand-main { font-size: 1.25rem; font-weight: 800; color: var(--text); }
    .brand-sub { font-size: 0.75rem; font-weight: 600; color: var(--text-sub); letter-spacing: 0.02em; }
    .header-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 10;
    }
    .live-badge {
      font-size: 0.7rem;
      padding: 6px 10px;
      border-radius: 99px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.3s ease;
    }
    .live-badge.online { background: rgba(255, 107, 107, 0.15); color: var(--accent-busy); }
    .live-badge.offline { background: var(--surface-sub); color: var(--text-sub); }
    .live-dot {
      width: 6px;
      height: 6px;
      background: currentColor;
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
    .status-card {
      width: 100%;
      background: var(--surface);
      border-radius: 24px;
      padding: 32px 24px;
      text-align: center;
      box-shadow: var(--card-shadow);
      transition: all 0.3s ease;
      border: 1px solid transparent;
      margin: 0;
    }
    .status-text { font-size: 2rem; font-weight: 800; margin-bottom: 8px; letter-spacing: -0.02em; }
    .status-sub { color: var(--text-sub); font-size: 0.9rem; font-weight: 600; min-height: 1.4em; }
    .status-card.busy .status-text { color: var(--accent-busy); }
    .status-card.free .status-text { color: var(--accent-free); }
    .status-card.closed { background: var(--surface-sub); box-shadow: none; border: 1px solid var(--border); }
    .status-card.closed .status-text { color: var(--text-sub); }
    .status-card.closed .metric-val { color: var(--text-sub); opacity: 0.5; }
    .status-card.closed .person-icon { color: var(--border) !important; }
    .visual-queue { display: flex; justify-content: center; flex-wrap: wrap; gap: 8px; margin: 24px 0; min-height: 40px; }
    .person-icon {
      font-family: 'Material Icons Round';
      font-size: 32px;
      color: var(--text-sub);
      opacity: 0;
      transform: scale(0.5);
      animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }
    .person-icon.active { color: var(--primary); }
    @keyframes popIn { to { opacity: 1; transform: scale(1); } }
    .metrics { display: flex; justify-content: space-around; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border); }
    .metric-item { display: flex; flex-direction: column; gap: 4px; }
    .metric-val { font-size: 1.4rem; font-weight: 800; }
    .metric-label { font-size: 0.75rem; color: var(--text-sub); font-weight: 600; }
    .last-update { margin-top: 16px; font-size: 0.7rem; color: var(--text-sub); text-align: right; opacity: 0.8; }
    .graph-section { background: var(--surface); border-radius: 20px; padding: 20px; box-shadow: var(--card-shadow); }
    .graph-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .section-title { font-size: 0.9rem; font-weight: 700; margin: 0; color: var(--text-sub); }
    .day-select {
      -webkit-appearance: none;
      appearance: none;
      background-color: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      height: 48px;
      padding: 0 40px 0 16px;
      min-width: 120px;
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
      cursor: pointer;
      outline: none;
      transition: border-color 0.2s;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%232c2420' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 16px;
    }
    body.dark-mode .day-select {
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23f5f0e6' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    }
    .day-select:active { border-color: var(--primary); }
    .chart-container { position: relative; height: 180px; width: 100%; }
    .no-data-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--surface);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      z-index: 10;
    }
    .no-data-overlay.visible { opacity: 1; pointer-events: auto; }
    .no-data-text { color: var(--text-sub); font-size: 0.85rem; font-weight: 600; margin-top: 8px; }
    .no-data-icon { font-size: 48px; color: var(--border); }
    .sidebar-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      z-index: 900;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      backdrop-filter: blur(2px);
    }
    .sidebar-overlay.visible { opacity: 1; pointer-events: auto; }
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 280px;
      max-width: 80%;
      background: var(--surface-alpha);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      box-shadow: var(--sidebar-shadow);
      z-index: 1000;
      transform: translateX(-100%);
      transition: transform 0.35s cubic-bezier(0.16, 1, 0.3, 1);
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--border);
    }
    .sidebar.open { transform: translateX(0); }
    .sidebar-header {
      padding: 24px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
    }
    .sidebar-title { font-size: 1.2rem; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 8px; }
    .sidebar-content { flex: 1; overflow-y: auto; padding: 16px 0; }
    .sidebar-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px 24px;
      background: none;
      border: none;
      width: 100%;
      text-align: left;
      color: var(--text);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    .sidebar-item:active { background: var(--surface-sub); }
    .sidebar-item .material-icons-round { color: var(--text-sub); font-size: 1.5rem; }
    .sidebar-footer {
      padding: 20px;
      text-align: center;
      font-size: 0.75rem;
      color: var(--text-sub);
      border-top: 1px solid var(--border);
    }
    .overlay-base {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      z-index: 1200;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      display: flex;
    }
    .overlay-base.open { opacity: 1; pointer-events: auto; }
    #menuModal, #feedbackModal { justify-content: center; align-items: flex-end; }
    #aboutModal, #graphHelpModal { justify-content: center; align-items: center; }
    .menu-sheet {
      background: var(--surface);
      width: 100%;
      max-width: 500px;
      height: auto;
      max-height: 85vh;
      border-radius: 24px 24px 0 0;
      padding: 24px;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      display: flex;
      flex-direction: column;
      border: 1px solid var(--border);
      border-bottom: none;
      box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.2);
    }
    #menuModal.open .menu-sheet, #feedbackModal.open .menu-sheet { transform: translateY(0); }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .close-btn { background: var(--surface-sub); color: var(--text); border: none; width: 36px; height: 36px; border-radius: 50%; display: grid; place-items: center; cursor: pointer; }
    .menu-viewer {
      flex: 1;
      overflow: auto;
      display: block;
      text-align: center;
      background: var(--surface-sub);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      margin-top: 10px;
      scrollbar-width: none;
      -ms-overflow-style: none;
      cursor: grab;
      overscroll-behavior: contain;
      touch-action: none;
      user-select: none;
    }
    .menu-viewer::-webkit-scrollbar { display: none; }
    .menu-viewer:active { cursor: grabbing; }
    .menu-viewer img { width: 100%; height: auto; border-radius: 8px; display: block; -webkit-user-drag: none; transform-origin: top center; }
    .menu-viewer img.zoomed { width: 300%; max-width: none; margin: 0 auto; }
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; font-size: 0.85rem; font-weight: 700; margin-bottom: 8px; color: var(--text-sub); }
    .form-select, .form-textarea { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--border); background: var(--surface); color: var(--text); font-family: inherit; font-size: 1rem; resize: none; outline: none; transition: border-color 0.2s; }
    .form-select:focus, .form-textarea:focus { border-color: var(--primary); }
    .form-textarea { height: 120px; }
    .submit-btn { width: 100%; padding: 16px; background: var(--primary); color: #fff; border: none; border-radius: 12px; font-weight: 700; font-size: 1rem; cursor: pointer; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .submit-btn:hover { background: var(--primary-dark); }
    .submit-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    #notifyModal { justify-content: center; align-items: center; }
    .notify-dialog {
      background: var(--surface);
      width: 90%;
      max-width: 440px;
      padding: 24px;
      border-radius: 20px;
      text-align: center;
      box-shadow: var(--card-shadow);
    }
    .notify-dialog h2 { margin: 0 0 12px; font-size: 1.1rem; }
    .notify-dialog p { font-size: 0.9rem; color: var(--text-sub); margin-bottom: 20px; line-height: 1.5; }
    .btn-group { display: flex; gap: 12px; }
    .btn { flex: 1; padding: 12px; border: none; border-radius: 12px; font-weight: 700; font-size: 0.9rem; cursor: pointer; }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-secondary { background: var(--surface-sub); color: var(--text); }
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-150%);
      background: var(--surface);
      padding: 16px 24px;
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 1500;
      transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
      min-width: 280px;
      border: 1px solid var(--border);
    }
    .toast.show { transform: translateX(-50%) translateY(0); }
    .toast-icon { font-size: 1.5rem; }
    .toast-content div:first-child { font-weight: 700; font-size: 0.9rem; color: var(--text); }
    .toast-content div:last-child { font-size: 0.8rem; color: var(--text-sub); }
    .pwa-banner {
      position: fixed;
      bottom: 24px;
      left: 20px;
      width: calc(100% - 40px);
      max-width: 360px;
      right: auto;
      background: var(--surface);
      border: 1px solid var(--primary);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      z-index: 200;
      display: flex;
      flex-direction: column;
      gap: 12px;
      transform: translateY(150%);
      transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
    }
    .pwa-banner.visible { transform: translateY(0); }
    .pwa-title { font-size: 0.95rem; font-weight: 800; color: var(--primary); margin: 0; display: flex; align-items: center; gap: 6px; }
    .pwa-desc { font-size: 0.8rem; color: var(--text); margin: 0; line-height: 1.5; }
    .pwa-btn { background: var(--primary); color: #fff; border: none; padding: 10px; border-radius: 8px; font-weight: 700; font-size: 0.85rem; cursor: pointer; text-align: center; }
    .pwa-close {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 32px;
      height: 32px;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 50%;
      border: none;
      color: var(--text-sub);
      cursor: pointer;
      display: grid;
      place-items: center;
      transition: background 0.2s;
    }
    .pwa-close:hover { background: rgba(0, 0, 0, 0.1); }
  </style>
</head>
<body>
  <div id="pseudoNotify" class="toast">
    <div class="toast-icon">âœ¨</div>
    <div class="toast-content">
      <div id="toastTitle">ç©ºã„ã¦ãã¾ã—ãŸï¼</div>
      <div id="toastBody">ä»ŠãŒãƒãƒ£ãƒ³ã‚¹ã§ã™</div>
    </div>
  </div>
  <div id="notifyModal" class="overlay-base">
    <div class="notify-dialog">
      <h2>é€šçŸ¥ã‚’ã‚ªãƒ³ã«ã—ã¾ã™ã‹ï¼Ÿ</h2>
      <p>è¡Œåˆ—ãŒè§£æ¶ˆã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§<br>ãŠçŸ¥ã‚‰ã›ã‚’å—ã‘å–ã‚Œã¾ã™ã€‚</p>
      <div class="btn-group">
        <button class="btn btn-secondary" id="notifyNo">ã‚ã¨ã§</button>
        <button class="btn btn-primary" id="notifyYes">è¨±å¯ã™ã‚‹</button>
      </div>
    </div>
  </div>
  <div class="overlay-base" id="aboutModal">
    <div class="notify-dialog" style="text-align:left">
      <div class="modal-header" style="margin-bottom:12px">
        <h3 style="margin:0;font-size:1.1rem">æ¸¬å®šã‚·ã‚¹ãƒ†ãƒ ã«ã¤ã„ã¦</h3>
        <button class="close-btn" id="closeAbout"><span class="material-icons-round">close</span></button>
      </div>
      <p style="font-size:0.9rem;color:var(--text);line-height:1.7">ç¾åœ¨ã®å¾…ã¡äººæ•°ã¯ã€è¨­ç½®ã•ã‚ŒãŸã‚«ãƒ¡ãƒ©ã®æ˜ åƒã‚’<strong>AIï¼ˆäººå·¥çŸ¥èƒ½ï¼‰ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è§£æ</strong>ã—ã€è‡ªå‹•ã§è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚</p>
      <p style="font-size:0.9rem;color:var(--text);line-height:1.7;margin-top:12px">å¯èƒ½ãªé™ã‚Šæ­£ç¢ºãªå€¤ã‚’ç®—å‡ºã™ã‚‹ã‚ˆã†èª¿æ•´ã—ã¦ãŠã‚Šã¾ã™ãŒã€æ··é›‘æ™‚ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªè¦å› ã«ã‚ˆã‚Šèª¤å·®ãŒç”Ÿã˜ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
      <ul style="font-size:0.85rem;color:var(--text-sub);background:var(--surface-sub);padding:12px 12px 12px 28px;border-radius:8px;margin-top:12px">
        <li>æ··é›‘æ™‚ã€äººãŒé‡ãªã£ã¦æ˜ ã£ã¦ã„ã‚‹å ´åˆ</li>
        <li>å­£ç¯€ã€å¤©æ°—ã«ã‚ˆã£ã¦å…‰ã®é‡ã®å¤‰åŒ–ã™ã‚‹å½±éŸ¿</li>
        <li>ä¸€èˆ¬é£Ÿã«ä¸¦ã‚“ã§ã„ã‚‹æ–¹ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã¦ã—ã¾ã†å ´åˆ</li>
        <li>ã¨ã¦ã‚‚æ··é›‘ã—ã¦ãŠã‚Šã€èªè­˜ã®é™ç•Œã®å ´åˆ</li>
      </ul>
      <p style="font-size:0.85rem;color:var(--text-sub);margin-top:12px;text-align:center">â€» æ··é›‘æ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹äººæ•°ã¯ã€Œç›®å®‰ã€ã¨ã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚</p>
    </div>
  </div>
  <div class="overlay-base" id="graphHelpModal">
    <div class="notify-dialog" style="text-align:left">
      <div class="modal-header" style="margin-bottom:12px">
        <h3 style="margin:0;font-size:1.1rem">ã‚°ãƒ©ãƒ•ã®æ•°å€¤ã«ã¤ã„ã¦</h3>
        <button class="close-btn" id="closeGraphHelp"><span class="material-icons-round">close</span></button>
      </div>
      <p style="font-size:0.9rem;color:var(--text);line-height:1.6">å½“ã‚·ã‚¹ãƒ†ãƒ ã®æ··é›‘äººæ•°ã¯ã€ã‚«ãƒ¡ãƒ©ãŒ10ç§’ã«1åº¦æ¤œçŸ¥ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’AIãŒ<strong>1åˆ†é–“ã”ã¨ã«å¹³å‡å€¤ã‚’ç®—å‡º</strong>ã™ã‚‹ã“ã¨ã§ã€èª¤å·®ã®æ¸›å°‘ã‚’è©¦ã¿ã¦ã„ã¾ã™ã€‚</p>
      <p style="font-size:0.9rem;color:var(--text);line-height:1.6">ãã®ãŸã‚ã€<strong>ã€Œ1.5äººã€ã®ã‚ˆã†ã«å°æ•°ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™</strong>ãŒã€ã“ã‚Œã¯è¨ˆç®—ä¸Šã®å¹³å‡å€¤ã§ã™ã€‚</p>
    </div>
  </div>
  <div id="pwaBanner" class="pwa-banner">
    <button class="pwa-close" id="pwaClose"><span class="material-icons-round" style="font-size:1.2rem">close</span></button>
    <h3 class="pwa-title"><span class="material-icons-round">add_to_home_screen</span> ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ </h3>
    <p class="pwa-desc" id="pwaDesc">ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ä½¿ãˆã¦é€šçŸ¥ã‚‚å—ã‘å–ã‚Œã¾ã™ï¼</p>
    <button id="pwaInstallBtn" class="pwa-btn" style="display:none">ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</button>
  </div>
  <div id="sidebarOverlay" class="sidebar-overlay"></div>
  <nav id="appSidebar" class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-title"><span class="material-icons-round" style="color:var(--primary)">restaurant_menu</span>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
      <button class="close-btn" id="sidebarCloseBtn"><span class="material-icons-round">close</span></button>
    </div>
    <div class="sidebar-content">
      <button class="sidebar-item" id="installOption"><span class="material-icons-round">download</span> ã‚¢ãƒ—ãƒªã‚’å…¥æ‰‹</button>
      <button class="sidebar-item" id="notifyOption"><span class="material-icons-round" id="notifyIconMenu">notifications</span> <span id="notifyLabelMenu">é€šçŸ¥è¨­å®š</span></button>
      <button class="sidebar-item" id="themeOption"><span class="material-icons-round" id="themeIconMenu">dark_mode</span> ãƒ†ãƒ¼ãƒåˆ‡æ›¿</button>
      <button class="sidebar-item" id="menuBtn"><span class="material-icons-round">menu_book</span> æœ¬æ—¥ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼</button>
      <button class="sidebar-item" id="shareBtn"><span class="material-icons-round">share</span> ã‚·ã‚§ã‚¢</button>
      <button class="sidebar-item" id="feedbackBtn"><span class="material-icons-round">chat_bubble_outline</span> ã”æ„è¦‹</button>
    </div>
    <div class="sidebar-footer">&copy; 2024 Smart Restaurant</div>
  </nav>
  <div class="container">
    <header>
      <button id="menuToggle" class="menu-toggle-btn"><span class="material-icons-round">menu</span></button>
      <div class="brand" onclick="window.location.reload()">
        <span class="material-icons-round brand-icon">restaurant_menu</span>
        <div class="brand-text">
          <span class="brand-main">å¿«é©é£Ÿå ‚</span>
          <span class="brand-sub">Smart Restaurant</span>
        </div>
      </div>
      <div class="header-controls">
        <div id="liveBadge" class="live-badge offline"><span class="material-icons-round" style="font-size:1rem">cloud_off</span> OFFLINE</div>
      </div>
    </header>
    <div id="mainCard" class="status-card">
      <div id="statusText" class="status-text">èª­ã¿è¾¼ã¿ä¸­...</div>
      <div id="waitMessage" class="status-sub">å°‘ã€…ãŠå¾…ã¡ãã ã•ã„</div>
      <div id="visualQueue" class="visual-queue"></div>
      <div class="metrics">
        <div class="metric-item">
          <span class="metric-val"><span id="count">--</span><span style="font-size:0.9rem">äºº</span></span>
          <span class="metric-label">ç¾åœ¨ã®è¡Œåˆ—<button id="aboutBtn" style="background:none;border:none;color:var(--text-sub);cursor:pointer;padding:0;vertical-align:middle;margin-left:4px"><span class="material-icons-round" style="font-size:1rem">help_outline</span></button></span>
        </div>
        <div class="metric-item">
          <span class="metric-val">~<span id="waitTime">--</span><span style="font-size:0.9rem">åˆ†</span></span>
          <span class="metric-label">æ¨å®šå¾…ã¡æ™‚é–“</span>
        </div>
      </div>
      <div id="lastUpdateText" class="last-update">æœ€çµ‚æ›´æ–°: --/-- --:--</div>
    </div>
    <div class="graph-section">
      <div class="graph-header">
        <h2 class="section-title">æ··é›‘ã®å‚¾å‘ã‚°ãƒ©ãƒ•<button id="graphHelpBtn" style="background:none;border:none;color:var(--text-sub);cursor:pointer;padding:0;vertical-align:middle;margin-left:4px"><span class="material-icons-round" style="font-size:1rem">help_outline</span></button></h2>
        <select id="daySelector" class="day-select">
          <option value="0">æ—¥æ›œæ—¥</option>
          <option value="1">æœˆæ›œæ—¥</option>
          <option value="2">ç«æ›œæ—¥</option>
          <option value="3">æ°´æ›œæ—¥</option>
          <option value="4">æœ¨æ›œæ—¥</option>
          <option value="5">é‡‘æ›œæ—¥</option>
          <option value="6">åœŸæ›œæ—¥</option>
        </select>
      </div>
      <div class="chart-container">
        <canvas id="lunchChart"></canvas>
        <div id="noDataOverlay" class="no-data-overlay">
          <span class="material-icons-round no-data-icon">show_chart</span>
          <div class="no-data-text">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>
        </div>
      </div>
    </div>
  </div>
  <div class="overlay-base" id="feedbackModal">
    <div class="menu-sheet">
      <div class="modal-header">
        <h2 style="margin:0;font-size:1.1rem">ã”æ„è¦‹ãƒ»ã”è¦æœ›</h2>
        <button class="close-btn" id="closeFeedback"><span class="material-icons-round">close</span></button>
      </div>
      <div style="padding-bottom:20px">
        <div class="form-group">
          <label class="form-label">ç¨®é¡</label>
          <select id="fbCategory" class="form-select">
            <option value="food">ğŸ½ é£Ÿäº‹ã«ã¤ã„ã¦ï¼ˆå…·ä½“çš„ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼åãªã©ï¼‰</option>
            <option value="service">ğŸ“± ã‚µãƒ¼ãƒ“ã‚¹ã«ã¤ã„ã¦ï¼ˆå¿«é©é£Ÿå ‚ï¼‰</option>
            <option value="other">ğŸ’¬ ãã®ä»–</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">å†…å®¹</label>
          <textarea id="fbMessage" class="form-textarea" placeholder="ã”è‡ªç”±ã«ãŠæ›¸ããã ã•ã„..."></textarea>
        </div>
        <button id="fbSubmit" class="submit-btn">é€ä¿¡ã™ã‚‹ <span class="material-icons-round">send</span></button>
      </div>
    </div>
  </div>
  <div class="overlay-base" id="menuModal">
    <div class="menu-sheet">
      <div class="modal-header">
        <h2 style="margin:0;font-size:1.1rem">ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨</h2>
        <button class="close-btn" id="closeMenu"><span class="material-icons-round">close</span></button>
      </div>
      <p style="font-size:0.8rem;color:var(--text-sub);text-align:center;margin:0 0 10px 0"><span class="material-icons-round" style="font-size:0.9rem;vertical-align:middle">touch_app</span> ã‚¿ãƒƒãƒ—ã§æ‹¡å¤§ / ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•</p>
      <div class="menu-viewer" id="menuContainer">
        <img id="menuImage" draggable="false" src="menu_img.png" alt="æœ¬æ—¥ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼" onerror="this.style.display='none';this.parentElement.innerHTML='<p style=\'text-align:center;color:#888;margin-top:20px\'>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>'" />
      </div>
    </div>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    const firebaseConfig = { databaseURL: "https://traffic-restaurant-default-rtdb.firebaseio.com/" };
    const MINUTES_PER_PERSON = 0.3, isIphone = /iPhone|iPad|iPod/i.test(navigator.userAgent), DATA_TIMEOUT_MINUTES = 1;
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxYAdVhS19brD2FfGizWH5jBCUXGSLFTfq60wvLCCxkjptYz7WUpQZ71ay2lFoTtEv16w/exec";
    const app = initializeApp(firebaseConfig), db = getDatabase(app);
    const countEl = document.getElementById("count"), waitTimeEl = document.getElementById("waitTime"), statusTextEl = document.getElementById("statusText"), waitMessageEl = document.getElementById("waitMessage"), visualQueueEl = document.getElementById("visualQueue"), mainCard = document.getElementById("mainCard"), daySelector = document.getElementById("daySelector"), liveBadgeEl = document.getElementById("liveBadge"), lastUpdateTextEl = document.getElementById("lastUpdateText"), noDataOverlay = document.getElementById("noDataOverlay"), menuBtn = document.getElementById("menuBtn"), menuModal = document.getElementById("menuModal"), closeMenu = document.getElementById("closeMenu"), notifyModal = document.getElementById("notifyModal"), notifyYes = document.getElementById("notifyYes"), notifyNo = document.getElementById("notifyNo"), pseudoNotify = document.getElementById("pseudoNotify"), shareBtn = document.getElementById("shareBtn"), feedbackBtn = document.getElementById("feedbackBtn"), feedbackModal = document.getElementById("feedbackModal"), closeFeedback = document.getElementById("closeFeedback"), fbSubmit = document.getElementById("fbSubmit"), fbCategory = document.getElementById("fbCategory"), fbMessage = document.getElementById("fbMessage");
    const toastTitle = document.getElementById("toastTitle"), toastBody = document.getElementById("toastBody");
    const aboutBtn = document.getElementById("aboutBtn"), aboutModal = document.getElementById("aboutModal"), closeAbout = document.getElementById("closeAbout");
    const graphHelpBtn = document.getElementById("graphHelpBtn"), graphHelpModal = document.getElementById("graphHelpModal"), closeGraphHelp = document.getElementById("closeGraphHelp");
    daySelector.value = new Date().getDay();
    aboutBtn.onclick = () => aboutModal.classList.add("open");
    closeAbout.onclick = () => aboutModal.classList.remove("open");
    aboutModal.onclick = e => { if (e.target === aboutModal) aboutModal.classList.remove("open") };
    graphHelpBtn.onclick = () => graphHelpModal.classList.add("open");
    closeGraphHelp.onclick = () => graphHelpModal.classList.remove("open");
    graphHelpModal.onclick = e => { if (e.target === graphHelpModal) graphHelpModal.classList.remove("open") };
    const themeOption = document.getElementById("themeOption"), themeIconMenu = document.getElementById("themeIconMenu"), savedTheme = localStorage.getItem("theme");
    if (savedTheme === "dark") { document.body.classList.add("dark-mode"); themeIconMenu.textContent = "light_mode"; } else { document.body.classList.remove("dark-mode"); themeIconMenu.textContent = "dark_mode"; }
    themeOption.onclick = () => {
      document.body.classList.toggle("dark-mode");
      const isDark = document.body.classList.contains("dark-mode");
      themeIconMenu.textContent = isDark ? "light_mode" : "dark_mode";
      localStorage.setItem("theme", isDark ? "dark" : "light");
      if (chart) {
        const tColor = getComputedStyle(document.body).getPropertyValue('--text-sub').trim();
        const bColor = getComputedStyle(document.body).getPropertyValue('--border').trim();
        chart.options.scales.x.ticks.color = tColor;
        chart.options.scales.y.ticks.color = tColor;
        chart.options.scales.y.grid.color = bColor;
        chart.update();
      }
      closeSidebar();
    };
    const menuToggle = document.getElementById("menuToggle"), appSidebar = document.getElementById("appSidebar"), sidebarOverlay = document.getElementById("sidebarOverlay"), sidebarCloseBtn = document.getElementById("sidebarCloseBtn");
    function openSidebar() { appSidebar.classList.add("open"); sidebarOverlay.classList.add("visible"); }
    function closeSidebar() { appSidebar.classList.remove("open"); sidebarOverlay.classList.remove("visible"); }
    menuToggle.onclick = openSidebar; sidebarCloseBtn.onclick = closeSidebar; sidebarOverlay.onclick = closeSidebar;
    const notifyOption = document.getElementById("notifyOption"), notifyIconMenu = document.getElementById("notifyIconMenu"), notifyLabelMenu = document.getElementById("notifyLabelMenu");
    let isAppNotifyEnabled = localStorage.getItem("app_notify_enabled") !== "false";
    function updateNotifyButtonUI() {
      if (Notification.permission === "granted") {
        if (isAppNotifyEnabled) { notifyIconMenu.textContent = "notifications_off"; notifyLabelMenu.textContent = "é€šçŸ¥OFF"; }
        else { notifyIconMenu.textContent = "notifications_active"; notifyLabelMenu.textContent = "é€šçŸ¥ON"; }
      } else { notifyIconMenu.textContent = "notifications"; notifyLabelMenu.textContent = "é€šçŸ¥è¨­å®š"; }
    }
    if (!isIphone && "Notification" in window) updateNotifyButtonUI();
    let toastTimer;
    function showToast(title, body) {
      if (toastTimer) clearTimeout(toastTimer);
      toastTitle.textContent = title; toastBody.textContent = body;
      pseudoNotify.classList.add("show");
      toastTimer = setTimeout(() => { pseudoNotify.classList.remove("show"); }, 3000);
    }
    notifyOption.onclick = () => {
      closeSidebar();
      if (!("Notification" in window)) { alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯é€šçŸ¥ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚"); return; }
      if (Notification.permission === "granted") {
        isAppNotifyEnabled = !isAppNotifyEnabled;
        localStorage.setItem("app_notify_enabled", isAppNotifyEnabled);
        updateNotifyButtonUI();
        if (isAppNotifyEnabled) showToast("ğŸ”” é€šçŸ¥ã‚’ONã«ã—ã¾ã—ãŸ", "æ··é›‘ãŒè§£æ¶ˆã•ã‚ŒãŸã‚‰ãŠçŸ¥ã‚‰ã›ã—ã¾ã™");
        else showToast("ğŸ”• é€šçŸ¥ã‚’OFFã«ã—ã¾ã—ãŸ", "ã‚¢ãƒ—ãƒªã‹ã‚‰ã®é€šçŸ¥ã‚’åœæ­¢ã—ã¾ã™(å†åº¦å¤‰æ›´å¯èƒ½)");
      } else if (Notification.permission === "denied") {
        alert("é€šçŸ¥ãŒãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™ã€‚\nè§£é™¤ã™ã‚‹ã«ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šç”»é¢ã‹ã‚‰é€šçŸ¥ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚");
      } else { notifyModal.classList.add("open"); }
    };
    notifyYes.onclick = async () => {
      const permission = await Notification.requestPermission();
      notifyModal.classList.remove("open");
      if (permission === "granted") {
        isAppNotifyEnabled = true; localStorage.setItem("app_notify_enabled", "true"); updateNotifyButtonUI();
        showToast("è¨­å®šå®Œäº†", "é€šçŸ¥ãŒè¨±å¯ã•ã‚Œã¾ã—ãŸï¼");
        try { new Notification("è¨­å®šå®Œäº†", { body: "é€šçŸ¥ãŒè¨±å¯ã•ã‚Œã¾ã—ãŸï¼", icon: "/favicon.ico" }); } catch (e) {}
      }
    };
    const pwaBanner = document.getElementById("pwaBanner"), pwaClose = document.getElementById("pwaClose"), pwaDesc = document.getElementById("pwaDesc"), pwaInstallBtn = document.getElementById("pwaInstallBtn"), installOption = document.getElementById("installOption");
    let deferredPrompt;
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
    const isPwaClosed = localStorage.getItem("pwa_closed_v5");
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    const isFirefox = /firefox/i.test(navigator.userAgent);
    if (isStandalone) { installOption.style.display = 'none'; }
    if (!isStandalone && !isPwaClosed && isMobile) {
      setTimeout(() => {
        if (isIphone) {
          pwaDesc.innerHTML = 'ç”»é¢ä¸‹ã® <span class="material-icons-round" style="vertical-align:middle;font-size:1.1em">ios_share</span> ã‹ã‚‰<br>ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã—ã¦ã­ï¼';
          pwaBanner.classList.add("visible");
        } else if (isFirefox) {
          pwaDesc.innerHTML = 'ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¡ãƒ‹ãƒ¥ãƒ¼ <span class="material-icons-round" style="vertical-align:middle;font-size:1.1em">more_vert</span> ã‹ã‚‰<br>ã€Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€ã‚’é¸ã‚“ã§ã­ï¼';
          pwaBanner.classList.add("visible");
        }
      }, 3000);
    }
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault(); deferredPrompt = e;
      if (!isStandalone && !isPwaClosed && isMobile && !isFirefox) {
        setTimeout(() => { pwaInstallBtn.style.display = "block"; pwaBanner.classList.add("visible"); }, 3000);
      }
    });
    installOption.onclick = () => {
      closeSidebar();
      if (isStandalone) { alert("ã™ã§ã«ã‚¢ãƒ—ãƒªã¨ã—ã¦èµ·å‹•ã—ã¦ã„ã¾ã™ã€‚"); return; }
      if (isIphone) {
        pwaDesc.innerHTML = 'ç”»é¢ä¸‹ã® <span class="material-icons-round" style="vertical-align:middle;font-size:1.1em">ios_share</span> ã‹ã‚‰<br>ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã—ã¦ã­ï¼';
        pwaBanner.classList.add("visible");
      } else if (isFirefox) {
        alert("Firefoxã‚’ãŠä½¿ã„ã§ã™ã­ï¼\n\nURLã®å·¦ã«ã‚ã‚‹éµãƒãƒ¼ã‚¯ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã«ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ä½œæˆã§ãã¾ã™ï¼");
      } else if (deferredPrompt) {
        pwaInstallBtn.style.display = "block"; pwaBanner.classList.add("visible");
      } else {
        alert("ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç”»é¢ãŒå‡ºãªã„å ´åˆ\n\nãƒ›ãƒ¼ãƒ ç”»é¢ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’å‰Šé™¤ã—ã¦ã‚‚ã€ã‚¹ãƒãƒ›ã®ä¸­ã«ã€Œã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ¼ã‚¿ã€ãŒæ®‹ã£ã¦ã„ã‚‹ãŸã‚ã€ãƒœã‚¿ãƒ³ãŒåå¿œã—ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚\n\nè§£æ±ºç­–\n1.ã‚¹ãƒãƒ›ã®ã€Œè¨­å®šã€ã‚„ã‚¿ã‚¹ã‚¯ãƒãƒ¼ã®ã€Œæ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã€ã‹ã‚‰ã€å¿«é©é£Ÿå ‚ã€ã‚’æ¢ã—ã¦ã€å®Œå…¨ã«ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚\n2.å†åº¦ã€Œã‚¢ãƒ—ãƒªã‚’å…¥æ‰‹ã€ã‚’æŠ¼ã—ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚");
      }
    };
    pwaInstallBtn.onclick = async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') { pwaBanner.classList.remove("visible"); }
        deferredPrompt = null; localStorage.setItem("pwa_closed_v5", "true");
      }
    };
    pwaClose.onclick = () => { pwaBanner.classList.remove("visible"); localStorage.setItem("pwa_closed_v5", "true"); };
    menuBtn.onclick = () => { closeSidebar(); menuModal.classList.add("open"); };
    shareBtn.onclick = async () => {
      closeSidebar();
      let e = "";
      e = mainCard.classList.contains("closed") || "ãƒ‡ãƒ¼ã‚¿å—ä¿¡å¾…ã¡" === statusTextEl.textContent ? "å­¦é£Ÿã®æ··é›‘çŠ¶æ³ã‚’ãƒã‚§ãƒƒã‚¯ã—ã‚ˆã†ï¼\n" : `ç¾åœ¨ã®æ··é›‘çŠ¶æ³: ${countEl.textContent}äººå¾…ã¡ (${statusTextEl.textContent})\n`;
      const t = { title: 'å¿«é©é£Ÿå ‚', text: e, url: window.location.href };
      if (navigator.share) { try { await navigator.share(t) } catch (e) { } }
      else { alert("URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼å‹é”ã«å…±æœ‰ã—ã‚ˆã†ï¼"); navigator.clipboard.writeText(window.location.href); }
    };
    feedbackBtn.onclick = () => { closeSidebar(); feedbackModal.classList.add("open"); };
    closeMenu.onclick = () => menuModal.classList.remove("open");
    let isMenuBgDown = !1;
    menuModal.addEventListener('mousedown', e => { isMenuBgDown = (e.target === menuModal) });
    menuModal.addEventListener('mouseup', e => { if (isMenuBgDown && e.target === menuModal) menuModal.classList.remove("open"); isMenuBgDown = !1; });
    closeFeedback.onclick = () => feedbackModal.classList.remove("open");
    feedbackModal.onclick = e => { if (e.target === feedbackModal) feedbackModal.classList.remove("open") };
    fbSubmit.onclick = async () => {
      const e = fbMessage.value.trim();
      if (!e) { alert("å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
      fbSubmit.disabled = !0; fbSubmit.textContent = "é€ä¿¡ä¸­...";
      try {
        await push(ref(db, "feedbacks"), { category: fbCategory.value, message: e, timestamp: Date.now(), userAgent: navigator.userAgent });
        GAS_URL && "https://script.google.com/macros/s/AKfycbxYAdVhS19brD2FfGizWH5jBCUXGSLFTfq60wvLCCxkjptYz7WUpQZ71ay2lFoTtEv16w/exec" !== GAS_URL && fetch(GAS_URL, { method: "POST", mode: "no-cors", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ category: fbCategory.value, message: e }) }).catch(e => console.error(e));
        alert("ã”æ„è¦‹ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼é€ä¿¡ã—ã¾ã—ãŸã€‚"); fbMessage.value = ""; feedbackModal.classList.remove("open");
      } catch (e) { console.error(e); alert("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"); } finally { fbSubmit.disabled = !1; fbSubmit.innerHTML = 'é€ä¿¡ã™ã‚‹ <span class="material-icons-round">send</span>' }
    };
    if (!isIphone && "Notification" in window) {
      if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
      if (Notification.permission === "default") setTimeout(() => { notifyModal.classList.add("open") }, 1000);
    }
    notifyNo.onclick = () => { notifyModal.classList.remove("open") }
    function isBusinessOpen() { return !0 }
    function getStatus(e) { return e <= 0 ? "free" : e <= 1 ? "normal" : "busy" }
    let lastStatus = null, lastDataTimestamp = 0, currentTrendMessage = "";
    function triggerNotification() {
      if (!isAppNotifyEnabled) return;
      showToast("ç©ºã„ã¦ãã¾ã—ãŸï¼", "ä»ŠãŒãƒãƒ£ãƒ³ã‚¹ã§ã™");
      if (!isIphone && "Notification" in window && Notification.permission === "granted") {
        new Notification("å­¦é£ŸãŒç©ºã„ã¦ãã¾ã—ãŸï¼", { body: "ä»Šãªã‚‰ä¸¦ã°ãšã«è¡Œã‘ãã†ã§ã™ ğŸ½", icon: "/favicon.ico" });
      }
    }
    function updateUI(e, t) {
      lastDataTimestamp = 1e3 * t;
      const a = new Date(lastDataTimestamp), n = String(a.getHours()).padStart(2, '0'), o = String(a.getMinutes()).padStart(2, '0');
      lastUpdateTextEl.textContent = `æœ€çµ‚æ›´æ–°: ${a.getMonth() + 1}/${a.getDate()} ${n}:${o}`;
      checkLiveStatus();
      if (!isBusinessOpen()) { showClosedUI(); return }
      if ((Date.now() - lastDataTimestamp) / 1e3 / 60 > DATA_TIMEOUT_MINUTES) { showStaleDataUI(); return }
      countEl.textContent = e; waitTimeEl.textContent = Math.ceil(e * MINUTES_PER_PERSON); renderVisualQueue(e);
      const s = getStatus(e);
      if ("free" !== lastStatus && "free" === s) triggerNotification();
      lastStatus = s;
      mainCard.className = "status-card"; mainCard.classList.remove("free", "busy", "closed");
      if ("free" === s) { statusTextEl.textContent = "ç©ºã„ã¦ã„ã¾ã™"; mainCard.classList.add("free"); }
      else if ("normal" === s) statusTextEl.textContent = "ãµã¤ã†";
      else { statusTextEl.textContent = "æ··é›‘ä¸­"; mainCard.classList.add("busy"); }
      if (currentTrendMessage) waitMessageEl.textContent = currentTrendMessage;
      else if ("free" === s) waitMessageEl.textContent = "ä»ŠãŒãƒãƒ£ãƒ³ã‚¹ã§ã™ï¼";
      else if ("normal" === s) waitMessageEl.textContent = "å°‘ã—ä¸¦ã¶ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“";
      else waitMessageEl.textContent = "æ™‚é–“ã«ä½™è£•ã‚’æŒã£ã¦è¡Œãã¾ã—ã‚‡ã†";
    }
    function showClosedUI() {
      mainCard.className = "status-card closed"; statusTextEl.textContent = "å–¶æ¥­æ™‚é–“å¤–"; waitMessageEl.textContent = "æœ¬æ—¥ã®å–¶æ¥­ã¯çµ‚äº†ã—ã¾ã—ãŸ";
      countEl.textContent = "--"; waitTimeEl.textContent = "--"; visualQueueEl.innerHTML = '<span class="material-icons-round" style="font-size: 48px; color: #cbd5e1;">storefront</span>'
    }
    function showStaleDataUI() {
      mainCard.className = "status-card closed"; statusTextEl.textContent = "ãƒ‡ãƒ¼ã‚¿å—ä¿¡å¾…ã¡"; waitMessageEl.textContent = "ã‚«ãƒ¡ãƒ©ã‚·ã‚¹ãƒ†ãƒ ãŒåœæ­¢ä¸­ã§ã™";
      countEl.textContent = "--"; waitTimeEl.textContent = "--"; visualQueueEl.innerHTML = '<span class="material-icons-round" style="font-size: 48px; color: #cbd5e1;">cloud_off</span>'
    }
    function checkLiveStatus() {
      const e = Date.now() - lastDataTimestamp;
      if (e > 6e4) { liveBadgeEl.className = "live-badge offline"; liveBadgeEl.innerHTML = '<span class="material-icons-round" style="font-size: 1rem;">cloud_off</span> OFFLINE' }
      else { liveBadgeEl.className = "live-badge online"; liveBadgeEl.innerHTML = '<div class="live-dot"></div> LIVE' }
      if (isBusinessOpen() && e > 6e4 * DATA_TIMEOUT_MINUTES) showStaleDataUI()
    }
    setInterval(checkLiveStatus, 5e3);
    function renderVisualQueue(e) {
      visualQueueEl.innerHTML = "";
      const t = Math.min(e, 10);
      for (let a = 0; a < t; a++) {
        const e = document.createElement("span"); e.className = "material-icons-round person-icon"; e.textContent = "person"; e.style.animationDelay = `${.05 * a}s`; visualQueueEl.appendChild(e)
      }
      if (e > 10) { const t = document.createElement("span"); t.style.fontSize = "0.8rem"; t.style.color = "#999"; t.style.alignSelf = "center"; t.textContent = `+${e - 10}`; visualQueueEl.appendChild(t) }
    }
    onValue(ref(db, "line_status"), e => { const t = e.val(); if (t) { updateUI(t.people, t.timestamp); analyzeTrend() } });
    const ctx = document.getElementById("lunchChart").getContext("2d");
    let chart, allHistoryData = null;
    const currentLinePlugin = {
      id: 'currentLine',
      afterDatasetsDraw: e => {
        const t = new Date, a = t.getDay(), n = parseInt(daySelector.value);
        if (a !== n) return;
        const o = t.getHours(), s = t.getMinutes();
        if (o < 13 || o > 18) return;
        const i = e.ctx, r = e.scales.x, { top: l, bottom: c } = e.chartArea, d = `${String(o).padStart(2, '0')}:${String(s).padStart(2, '0')}`, u = r.getPixelForValue(d);
        if ("number" == typeof u && !isNaN(u)) {
          i.save(); i.beginPath(); i.moveTo(u, l); i.lineTo(u, c); i.lineWidth = 2; i.strokeStyle = '#ef4444'; i.stroke(); i.fillStyle = '#ef4444'; i.textAlign = 'center'; i.font = 'bold 10px Inter'; i.fillText('NOW', u, l - 5); i.restore()
        }
      }
    };
    function updateChart() {
      if (!allHistoryData) return;
      const e = parseInt(daySelector.value), t = new Date,
        a = Object.values(allHistoryData).filter(a => { const n = new Date(1e3 * a.timestamp); return n.getDay() === e && isSameDate(n, t) }),
        n = Object.values(allHistoryData).filter(t => { return new Date(1e3 * t.timestamp).getDay() === e });
      if (chart) { chart.destroy(); chart = null }
      const o = [];
      for (let e = 13; e <= 18; e++)for (let t = 0; t < 60; t++)o.push(`${String(e).padStart(2, "0")}:${String(t).padStart(2, "0")}`);
      const s = e => {
        const t = {};
        e.forEach(e => {
          const a = new Date(1e3 * e.timestamp), n = a.getHours(), o = a.getMinutes();
          if (n >= 13 && n <= 18) { const a = `${String(n).padStart(2, "0")}:${String(o).padStart(2, "0")}`; if (!t[a]) t[a] = []; t[a].push(e.people) }
        });
        return o.map(e => { const a = t[e]; return a ? Math.round(a.reduce((e, t) => e + t, 0) / a.length * 10) / 10 : null })
      }, i = s(a), r = s(n);
      window.latestAvgValues = r; window.timeLabels = o;
      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: o,
          datasets: [{
            label: "ä»Šæ—¥", data: i, borderColor: "#ff8533",
            backgroundColor: e => { const t = e.chart.ctx.createLinearGradient(0, 0, 0, 200); return t.addColorStop(0, "rgba(255,133,51,0.2)"), t.addColorStop(1, "rgba(255,133,51,0)"), t },
            borderWidth: 2, pointRadius: 3, fill: !0, tension: .4
          }, {
            label: "å¹³å‡", data: r, borderColor: "#8D6E63", borderWidth: 1.5, pointRadius: 1, pointBackgroundColor: "#8D6E63", fill: !1, tension: .4
          }]
        },
        options: {
          animation: !0, responsive: !0, maintainAspectRatio: !1, interaction: { intersect: !1, mode: 'index' },
          scales: {
            x: { grid: { display: !1 }, ticks: { maxTicksLimit: 5, color: getComputedStyle(document.body).getPropertyValue('--text-sub').trim() } },
            y: { display: !0, beginAtZero: !0, grid: { color: getComputedStyle(document.body).getPropertyValue('--border').trim() }, ticks: { color: getComputedStyle(document.body).getPropertyValue('--text-sub').trim(), callback: function (e) { return e + 'äºº' } } }
          },
          plugins: {
            legend: { display: !0 },
            zoom: { pan: { enabled: !0, mode: 'x' }, zoom: { wheel: { enabled: !0, modifierKey: 'ctrl' }, pinch: { enabled: !0 }, mode: 'x' } },
            tooltip: {
              callbacks: {
                label: function (e) {
                  let t = e.dataset.label || '';
                  if (t) { t += ': '; }
                  if (e.parsed.y !== null) { t += e.parsed.y + 'äºº'; }
                  return t;
                }
              }
            }
          }
        },
        plugins: [currentLinePlugin]
      })
    }
    function analyzeTrend() {
      if (!countEl.textContent || isNaN(parseInt(countEl.textContent))) return;
      const e = parseInt(countEl.textContent), t = window.latestAvgValues, a = window.timeLabels;
      if (!t || !a) return;
      const n = new Date, o = String(n.getHours()).padStart(2, '0'), s = String(n.getMinutes()).padStart(2, '0'), i = a.indexOf(`${o}:${s}`);
      let r = "";
      if (-1 !== i) {
        const a = t[i] || 0;
        if (a > 0) { if (e < 0.7 * a) r = "âœ¨ ä»Šã¯ã„ã¤ã‚‚ã‚ˆã‚Šç©ºã„ã¦ã¾ã™ï¼"; else if (e > 1.3 * a) r = "âš ï¸ ã„ã¤ã‚‚ã‚ˆã‚Šæ··ã‚“ã§ã¾ã™" }
        const n = i + 15;
        if (n < t.length) { const e = t[n] - a; if (e < -3) r += " (ã‚ã¨15åˆ†ã§ç©ºãäºˆå ± ğŸ“‰)"; else if (e > 3) r += " (ã“ã‚Œã‹ã‚‰æ··ã¿ãã†ã§ã™ ğŸ“ˆ)" }
      }
      if (r) { waitMessageEl.textContent = r; waitMessageEl.style.color = "#D32F2F"; waitMessageEl.style.fontWeight = "bold" }
      else {
        waitMessageEl.style.color = ""; waitMessageEl.style.fontWeight = "";
        r = "free" === getStatus(e) ? "ä»ŠãŒãƒãƒ£ãƒ³ã‚¹ã§ã™ï¼" : "normal" === getStatus(e) ? "æ¨™æº–çš„ãªæ··é›‘å…·åˆã§ã™" : "æ™‚é–“ã«ä½™è£•ã‚’æŒã£ã¦è¡Œãã¾ã—ã‚‡ã†";
        waitMessageEl.textContent = r
      }
    }
    function isSameDate(e, t) { return e.getFullYear() === t.getFullYear() && e.getMonth() === t.getMonth() && e.getDate() === t.getDate() }
    daySelector.addEventListener("change", updateChart);
    let lastChartUpdate = 0;
    onValue(ref(db, "line_history"), e => {
      allHistoryData = e.val();
      const t = Date.now();
      if (t - lastChartUpdate > 6e4) { updateChart(); lastChartUpdate = t }
      analyzeTrend()
    });
    const slider = document.getElementById('menuContainer'), menuImg = document.getElementById('menuImage');
    let isDown = !1, startX, startY, scrollLeft, scrollTop, isDragging = !1;
    const startDrag = (e, t, a) => {
      if (e.target === menuImg) {
        isDown = !0; isDragging = !1; slider.classList.add('active');
        startX = t - slider.offsetLeft; startY = a - slider.offsetTop;
        scrollLeft = slider.scrollLeft; scrollTop = slider.scrollTop
      }
    }, endDrag = (e, t, a) => {
      isDown = !1; slider.classList.remove('active');
      if (!isDragging) {
        const r = menuImg.getBoundingClientRect(),
          x = t || (e.changedTouches ? e.changedTouches[0].clientX : e.clientX),
          y = a || (e.changedTouches ? e.changedTouches[0].clientY : e.clientY),
          ratX = (x - r.left) / r.width, ratY = (y - r.top) / r.height;
        menuImg.classList.toggle('zoomed');
        if (menuImg.classList.contains('zoomed')) {
          const nW = slider.scrollWidth, nH = slider.scrollHeight;
          slider.scrollLeft = (nW * ratX) - (slider.clientWidth / 2);
          slider.scrollTop = (nH * ratY) - (slider.clientHeight / 2)
        }
      }
    }, moveDrag = (e, t, a) => {
      if (!isDown) return;
      e.preventDefault();
      const n = t - slider.offsetLeft, o = a - slider.offsetTop;
      if (Math.abs(n - startX) > 5 || Math.abs(o - startY) > 5) isDragging = !0;
      slider.scrollLeft = scrollLeft - (n - startX) * 1.5;
      slider.scrollTop = scrollTop - (o - startY) * 1.5
    };
    slider.addEventListener('mousedown', e => { e.preventDefault(); startDrag(e, e.pageX, e.pageY) });
    slider.addEventListener('mouseleave', () => { isDown = !1; slider.classList.remove('active') });
    slider.addEventListener('mouseup', e => endDrag(e, e.clientX, e.clientY));
    slider.addEventListener('mousemove', e => moveDrag(e, e.pageX, e.pageY));
    slider.addEventListener('touchstart', e => startDrag(e, e.touches[0].pageX, e.touches[0].pageY));
    slider.addEventListener('touchend', e => { if (e.cancelable) e.preventDefault(); endDrag(e, e.changedTouches[0].clientX, e.changedTouches[0].clientY) });
    slider.addEventListener('touchmove', e => moveDrag(e, e.touches[0].pageX, e.touches[0].pageY));
  </script>
</body>
</html>